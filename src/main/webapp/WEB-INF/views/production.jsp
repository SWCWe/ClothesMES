<%@page import="kr.smhrd.entity.ProductionVO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ page import="java.util.*"%>
<c:set var="path" value="${pageContext.request.contextPath}"/>

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>ÏÉùÏÇ∞Í¥ÄÎ¶¨ Page</title>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        <link href="${path}/resources/css/styles.css" rel="stylesheet" />
        <link href="${path}/resources/css/button.css" rel="stylesheet" />
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <!-- chart.js -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
        <!-- jquery Ï†ïÏùò -->
        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        
        
        <style>
        tr{
       
        	text-align : center;
        	font-size:16px;
        }
        
        a.dataTable-sorter{
        	text-align:center;
        }
        
        @media (max-width:576px) {
        	.add_production {
        		margin-left:-50px;
        	}
        }
        
        table input[type=text],
         table input[type=date],
         .custom_select
        {
        
       padding:0; margin:0; width:60%; ; border:none; background-color:transparent; height:30px; font-size:21px; text-align:center;
       }
       
       table input[type=text]:focus,
       table input[type=date]:focus,
       .custom_select
       {
      outline:none;
       }
       
       table tr{
       	height:40px;
       	line-height:40px;
       }
       
       .modal fade{
       	
       }
       
    </style>
    </head>
    <!-- Ï∞®Ìä∏Ïóê ÌîºÏöîÌïú Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ïãù -->
    <% String chartDatas = (String) request.getAttribute("chartDatas"); %>
    
    <body class="sb-nav-fixed">
      
 	<%@ include file="nav-top.jsp" %>
 	<div id="layoutSidenav">
    <div id="layoutSidenav_nav">
    	<%@ include file = "./nav.jsp" %>
        	</div>
            <div id="layoutSidenav_content" class="mt-2">
            	<main>
                	<div class="container-fluid px-4">
                		<h1 class="mt-4">ÏÉùÏÇ∞Í¥ÄÎ¶¨ üí´ <i class="fa-brands fa-waze fa-beat" style="color:black;"></i></h1>
                        <div class="card mb-4">
                        
                            <div class="card-header">
                            	 <!-- Ï∂úÍ≥† ÌòÑÌô© Ï∞®Ìä∏ -->
		                        <div class="card mb-4">
		                            <div class="card-header" onclick="chartShow()" style="height:45px;">
		                                <p>
			                                <i class="fas fa-chart-area me-1"></i>Ï†úÌíà ÏÉùÏÇ∞ ÌòÑÌô©
		                                </p>
		                            </div>
		                            
		                         <!-- Ï∞®Ìä∏ Îì§Ïñ¥Ïò¨ Î∂ÄÎ∂Ñ -->
			                     	<div id="manufactureChartArea" class="card-body" style="display:none;">
				                    	<div style="padding:1%;">
				                        	<canvas id="manufactureChart" style="overflow-x:scroll; width: 600px; height: 150px;"></canvas>
				                        </div>
			                    	</div>
		                        </div>
			                </div>
                         
                            <div class="card-body">         
                            	<!-- Í≤ÄÏÉâ Ìèº -->
	                            <div class="production-search mt-2 mb-4" style="display:flex; justify-content:center;">
	                            		<form id="manufactureSearch" method = "post" style="display:grid; grid-template-columns : 23% 23% 23% 23% 8%; grid-gap:10px; ">
	                            			
	                            			<div class="date-search-form">
	                            				<input id="start_r_date" type = "date" class =" form-control" name = "start_r_date">
	                            			</div>
	                            			
	                            			<div class="date-search-form">
	                            				<input id="end_r_date" type = "date" class =" form-control" name = "end_r_date">
	                            			</div>
	                            			
	                            			<!-- Ï†úÌíà ÏΩîÎìú Í≤ÄÏÉâ Î∂ÄÎ∂Ñ -->
	                            			<!-- Ï†úÌíà ÏΩîÎìú Ï§ëÎ≥µÏùÑ Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ Î≥ÑÎèÑÎ°ú ÎßåÎì† prod_codeListÎ°ú Î∞õÏïÑÏò®Îã§ -->
	                            			<!-- VO ÌòïÌÉúÍ∞Ä ÏïÑÎãå String prod_code Îã®ÏùºÍ∞íÏù¥Ïó¨ÏÑú ÏΩîÎìúÍ∞Ä Îì§Ïñ¥ÏûàÎäî Î≥ÄÏàò manufactureÎßå Ïì∞Î©¥Îê® -->
	                            			<!-- ${manufacture} (O) /  ${manufacture.prod_code} (X) -->
	                            			<div class="prod_code_search-form">
		                            			<select id="prod_code" class="form-select" name="prod_code">
		                            				<option selected disabled> Ï†úÌíà ÏΩîÎìú </option>
			                            				<c:forEach items = "${prod_codeList}" var="manufacture">
															<option>${manufacture}</option>
														</c:forEach>
		                            			</select>
	                            			</div>
	                            			
	                            			<!-- Îã¥Îãπ ÏÇ¨Ïõê Í≤ÄÏÉâ Î∂ÄÎ∂Ñ -->
	                            			<!-- Îã¥Îãπ ÏÇ¨Ïõê Ï§ëÎ≥µÏùÑ Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ Î≥ÑÎèÑÎ°ú ÎßåÎì† nameListÎ°ú Î∞õÏïÑÏò®Îã§ -->
	                            			<!-- VO ÌòïÌÉúÍ∞Ä ÏïÑÎãå String name Îã®ÏùºÍ∞íÏù¥Ïó¨ÏÑú ÏΩîÎìúÍ∞Ä Îì§Ïñ¥ÏûàÎäî Î≥ÄÏàò manufactureÎßå Ïì∞Î©¥Îê® -->
	                            			<!-- ${manufacture} (O) /  ${manufacture.name} (X) -->
	                            			<div class="prod_code_search-form">
		                            			<select id="name" class="form-select" name="name">
		                            				<option selected disabled> Îã¥Îãπ ÏÇ¨Ïõê </option>
			                            				<c:forEach items = "${nameList}" var="manufacture">
															<option>${manufacture}</option>
														</c:forEach>
		                            			</select>
	                            			</div>

	                            			
	                            			<div class="pruduction_form_button">
	                            				<!-- Í≤ÄÏÉâ Î≤ÑÌäº -->
	                            				<button type="button" onclick="manufactureSearch()" class="btn btn-light"> üîç </button>
	                            				<!-- Í≤ÄÏÉâ Î∂ÄÎ∂Ñ Ï¥àÍ∏∞Ìôî / ÏÉùÏÇ∞Í¥ÄÎ¶¨ ÌÖåÏù¥Î∏î Ï¥àÍ∏∞Ìôî Î≤ÑÌäº -->
		                            			<button type="reset"  onclick="prodload()" class="btn btn-dark">üîç </button>
	                            			</div>
	                            		</form>
	                            	</div>
 
                                <table class="table table-borderless table-striped table-hover" >
                                    <thead class="table-secondary" >
                                        <tr>
                                            <th style="width:10%;" scope="col">ÏÉùÏÇ∞ ÏàúÎ≤à</th>
                                            <th style="width:10%;" scope="col">Ï†úÌíà ÏΩîÎìú</th>
                                            <th style="width:12.5%;" scope="col">ÏÉùÏÇ∞ ÏùºÏûê</th>
                                            <th style="width:12.5%;" scope="col">ÏÉùÏÇ∞ ÏàòÎüâ</th>
                                            <th style="width:10%;" scope="col">Îã¥Îãπ ÏÇ¨Ïõê(ÏÇ¨ÏõêÎ≤àÌò∏)</th>
                                        	<th style="width:5%;" scope="col">ÏÇ≠Ï†ú</th>
                                        </tr>
                                    </thead>
                                 </table>
           
           						<!-- ÏÉùÏÇ∞Í¥ÄÎ¶¨ DBÏóê ÏûàÎäî Í∞í Î∞òÎ≥µÎ¨∏ ÌÜµÌï¥ Î≥¥Ïó¨Ï£ºÎäîÍ≥≥ -->
           						<form id="deleteprod" method="post">
           							<div style="overflow-y:scroll; width:100%; height:400px; text-align:center;">
		           						<table class="table table-borderless table-striped table-hover" >
                                    	<tbody id="prodList">
         								<!-- listÏóêÏÑú ÌïòÎÇòÏî© Í∫ºÎÇ¥ÏÑú Î≥ÄÏàò manufactureÏóê Îã¥ÏïÑÎùº ÎùºÎäî Îúª  -->
         								<!-- VOÏóê Î¨∂Ïó¨ÏûàÍ∏∞ÎïåÎ¨∏Ïóê ÏõêÌïòÎäî Í∞íÏùÑ Í∞ÄÏ†∏Ïò§Í∏∞ ÏúÑÌï¥ÏÑúÎäî  manufacture.m_seq Ïù¥Îü∞ ÌòïÌÉúÎ°ú Î∂àÎü¨ÏôÄÏïºÌï®-->
                                        <c:forEach items = "${list}" var="manufacture" >
                                        	<input type="hidden" name="m_seq" value = "${manufacture.m_seq}">
											<tr>
												<td style="width:14%;">${manufacture.m_seq}</td>
												<td style="width:15%;">${manufacture.prod_code}</td>
												<td style="width:19%;">${manufacture.prod_m_date}</td>
												<td style="width:16%;">${manufacture.m_cnt}</td>
												<td style="width:16.6%;">${manufacture.name}(${manufacture.emp_no})</td>
												<td style="width:5%;"><button type="button" data-bs-toggle="modal" data-bs-target="#exampleModal" class="btn btn-danger btn-sm">x</button></td>
											</tr>	
										</c:forEach>
                                 		</tbody>
		                               	</table>
	                               	</div>
                               	</form>
    
                                <!-- ÏÉùÏÇ∞ Ï∂îÍ∞Ä Î∂ÄÎ∂Ñ-->
                                <form id="manufactureInsertFrm" method="post">
                                    <table class="table table-borderless table-striped table-hover">
	                                   	<tbody>
	                                        <tr class="table-warning">
	                                        	<td style="width:20%;">             
	                                        		<input type="text" class="custom_code" placeholder = "Ï†úÌíà ÏΩîÎìú" name="prod_code"/>
	                                        	</td>
	                                        		
	                                        	<td style="width:20%;">
	                                        		<input type="date" class ="custom_m_date" name ="prod_m_date"/>
	                                       		</td>
	                                        		
	                                       		<td style="width:20%;">             
	                                       			<input type="text" class="custom_cnt" placeholder = "ÏÉùÏÇ∞ÏàòÎüâ" name="m_cnt"/>
	                                       		</td>
	                                        		
	                                       		<td style="width:20%;">             
	                                       			<input type="text" class="custom_emp_no" placeholder = "ÏÇ¨Ïõê Î≤àÌò∏ " name="emp_no"/>
	                                       		</td>
	
	                                       		<td style="width:20%;">
	                                       			<button type="button" onclick="manufactureInsert()" class="btn btn-primary btn-sm"> Ï∂îÍ∞Ä </button>
	                                       		</td>      	
	                                        </tr>  
                                    	</tbody>
                                	</table>
                               	</form>

                            </div>
                        </div>
                    </div>
                </main>
                <footer class="py-4 bg-light mt-auto">
                    <div class="container-fluid px-4">
                        <div class="d-flex align-items-center justify-content-between small">
                            <div class="text-muted">CPRMS</div>
                            <div>
                                <a href="#">made by</a>
                                &middot;
                                <a href="#">Ï´ëÏ´ëÏù¥</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        		
		<!-- Modal -->
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-sm">
		    	<div class="modal-content">
		    			         
		     	<div class="modal-header">
					Í≤åÏãúÎ¨ºÏùÑ Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
		     	</div>
			 	
			 	<div class="modal-footer">
		     		<button type="button" class="btn btn-primary" onclick="deleteprod()">ÏÇ≠Ï†úÌïòÍ∏∞</button>
		      		<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜåÌïòÍ∏∞</button>
			 	</div>
			      
				</div>
			</div>
		</div>
		
        
 		<script type="text/javascript">
 		
 		/* Ï∞®Ìä∏ Í¥ÄÎ†® Í∏∞Îä• */
		// Ï∞®Ìä∏ Íµ¨Ïó≠ Î≥¥Ïù¥Í∏∞
		function chartShow() {
			// Ïïà Î≥¥Ïù¥Î©¥ Î≥¥Ïù¥Í≤å, Î≥¥Ïù¥Î©¥ Ïïà Î≥¥Ïù¥Í≤å
			if ($('#manufactureChartArea').css('display') == 'none') {
					$('#manufactureChartArea').slideDown(400);
			} else {
					$('#manufactureChartArea').slideUp(400);
			}
		}
		
		// ÎèôÍ∏∞Î°ú Í∞ÄÏ†∏Ïò® Ï∞®Ìä∏Ïóê ÌïÑÏöîÌïú Îç∞Ïù¥ÌÑ∞
		var chartDatas = ${chartDatas}                  // Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú Í∞ÄÍ≥µÌïòÏó¨ ÎÑòÍ≤®Ï§Ä Îç∞Ïù¥ÌÑ∞Î•º jsonData Î≥ÄÏàòÏóê Îã¥ÎäîÎã§
		// ÌéòÏù¥ÏßÄÍ∞Ä Ïó¥Î†∏ÏùÑ Îïå Ïã§Ìñâ
		manufactureChart(chartDatas);
		
		// Ï∞®Ìä∏Î•º ÎßåÎì§ Ïàò ÏûàÎèÑÎ°ù Îç∞Ïù¥ÌÑ∞Î•º Î≥ÄÌôòÌï¥ÏÑú Ï∞®Ìä∏Î•º ÎßåÎì§Ïñ¥Ï£ºÎäî Ìï®Ïàò
		function manufactureChart(data) {
			// Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÉàÎ°ú Î∞òÏòÅÎê† ÎïåÎßàÎã§ Ï∞®Ìä∏Í∞Ä Í≤πÏ≥êÏÑú Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä Î≥¥Ïù¥Îäî ÏÉÅÌô©ÏùÑ Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥
			// ÏÇ≠Ï†ú ÌõÑ Îã§Ïãú ÎßåÎì§Í∏∞
			$('#manufactureChart').remove();
			$('#manufactureChartArea').append('<canvas id="manufactureChart" style="overflow-x:scroll; width: 600px; height: 150px;"></canvas>');
			
			var jsonObject = JSON.stringify(data);       // jsÏóêÏÑú Î¨∏ÏûêÏó¥ ÌòïÌÉúÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù Î≥ÄÌôò
			var jData = JSON.parse(jsonObject);          // Îã§Ïãú, json Í∞ùÏ≤¥Î°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ïû¨Î≥ÄÌôòÎêú Îç∞Ïù¥ÌÑ∞Î•º Îã¥Ïùå
			
			var labelList = new Array();
			var valueList = new Array();
			var colorList = new Array();
			
			for (var i = 0; i < jData.length; i++) {
				var d = jData[i];
				labelList.push(d.Code);     // jDataÏóê Îã¥Í≤®ÏûàÎäî Í∞íÎì§ Ï∂îÏ∂úÌïòÏó¨ Î∂ÑÎ∞∞
				valueList.push(d.Count);
				colorList.push(colorize()); // Í∑∏ÎÉ• ÎûúÎç§ÌïòÍ≤å ÏÉâÍπî ÎÑ£Ïñ¥Ï£ºÎäî Ìï®Ïàò
			}
			
			var datas = {
					labels : labelList,
					datasets : [{
						backgroundColor : colorList,
						data : valueList
					}]
			};
			
			var ctx1 = document.getElementById("manufactureChart").getContext('2d');
			
			new Chart(ctx1, {
				type : 'bar',
				data : datas,
				options : {
					legend : {
						display : false
					},
					scales : {
						yAxes : [
							{
								ticks:{
									beginAtZero: true, // yÏ∂ï Î≤îÏúÑÏÑ§Ï†ï 0Î∂ÄÌÑ∞ ÏãúÏûë
									fontSize : 14,
								}
							}
							
						],
						xAxes : [
							{
								ticks : {
									fontSize : 20 // xÏ∂ï Ìè∞Ìä∏ ÌÅ¨Í∏∞ ÏÑ§Ï†ï(Ï†úÌíà ÏΩîÎìú)
								}
							}
						]
					}
				}
			});
		}
		
		function colorize() { // ÎûúÎç§ÌïòÍ≤å ÏÉâÏùÑ ÎÑ£Ïñ¥Ï£ºÎäî Ìï®Ïàò. Í∑∏ÎÉ• Ìé∏ÏùòÎ•º ÏúÑÌï¥ ÎÑ£Ïùå
			var r = Math.floor(Math.random()*200);
			var g = Math.floor(Math.random()*200);
			var b = Math.floor(Math.random()*200);
			var color = 'rgba(' + r + ', ' + g + ', ' + b + ', 0.7)';
			return color;
		}
		

		// Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
		function loadChartData() {
			$.ajax({
				url : "loadChartManufacture.do",
				dataType : "JSON", 
				success : manufactureChart,
				error : function(e){
					console.log(e);
				}
			});
		}
 		
		
 		// formÏóêÏÑú Ï†ÑÏÜ°Ìïú Îç∞Ïù¥ÌÑ∞Î•º Î∞õÏïÑ Í≤ÄÏÉâ ÎÇ¥Ïö©ÏùÑ Ï°∞ÌöåÌïòÎäî Ìï®Ïàò
		function manufactureSearch() {
			// formÏóêÏÑú idÍ∞íÏù¥ manufactureSearch Ïù¥ Ï†ÑÏÜ°Ìïú Îç∞Ïù¥ÌÑ∞Î•º json ÌòïÌÉúÎ°ú Ï†ÄÏû•
			var frmData = $("#manufactureSearch").serialize();
			
			// ajaxÎ•º ÌÜµÌï¥ searchmanufacture.doÎùºÎäî Í≥≥ÏúºÎ°ú ÏûÖÎ†•Ìïú Îç∞ÌÑ∞Î•º Î≥¥ÎÇ¥ selectÌïòÍ≥†
			// prodListÎ°ú data Î≥¥ÎÉÑ
			$.ajax({
					url : "searchmanufacture.do",
					type : "POST",
					data : frmData,
					dataType : "JSON",
					success : prodList,
					error : function(e){
						console.log(e);
					}
				});
			};
 		
 		// Ï°∞Ìöå Í≤∞Í≥ºÎ•º Î∞õÏïÑ ÌôîÎ©¥Ïóê Î≥¥Ïó¨Ï£ºÎäî Ìï®Ïàò
		function prodList(data) {
			var html = "";
			for (var i = 0; i < data.length; i++) {
					html += "<input type ='hidden' name='m_seq' value = " + data[i].m_seq + ">"
					html += "<tr>";
					html += "<td style='width:14%;'>" + data[i].m_seq + "</td>";	
					html += "<td style='width:15%;'>" + data[i].prod_code + "</td>";	
					html += "<td style='width:19%;'>" + data[i].prod_m_date + "</td>";	
					html += "<td style='width:16%;'>" + data[i].m_cnt + "</td>";	
					html += "<td style='width:16.6%;'>" + data[i].name + "(" + data[i].emp_no + ")" + "</td>";
					html += "<td style='width:5%;'><button type='button' data-bs-toggle='modal' data-bs-target='#exampleModal' class='btn btn-danger btn-sm'>x</button></td>"
					html += "</tr>";
				}
				// idÍ∞Ä "prodList"Ïù∏ <tbody>ÏïàÏùò html ÍµêÏ≤¥
				$('#prodList').html(html);
			}
		
		// ÌòÑÏû¨ DBÏóê Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Î•º json ÌòïÌÉúÎ°ú Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
			function prodload() {
				$.ajax({
					url : "loadProd.do",
					success : prodList,
					error : function(e){
						console.log(e);
					}
				});
			}

		// ÏÇ≠Ï†ú Í∏∞Îä•
			function deleteprod() {
				var frmData = $('#deleteprod').serialize();
				$("#exampleModal").modal('hide');
				
				$.ajax({
					url : "deleteprod.do",
					type : "POST",
					data : frmData,
					success : prodload,
					error : function(e){
						console.log(e);
					}
				});
			}
			
	   		/* ÏÉùÏÇ∞ Ï†ïÎ≥¥ Ï∂îÍ∞Ä Í∏∞Îä• */
			// formÏóêÏÑú Ï†ÑÏÜ°Ìïú Îç∞Ïù¥ÌÑ∞Î•º Î∞õÏïÑ DBÏóê ÏÇΩÏûÖÌïòÎäî Ìï®Ïàò
			function manufactureInsert() {
				// formÏóêÏÑú idÍ∞íÏù¥ manufactureInsertFrm Ïù¥ Ï†ÑÏÜ°Ìïú Îç∞Ïù¥ÌÑ∞Î•º json ÌòïÌÉúÎ°ú Ï†ÄÏû•
				var frmData = $("#manufactureInsertFrm").serialize();
				
				// ajaxÎ•º ÌÜµÌï¥ insertmanufacture.doÎùºÎäî Í≥≥ÏúºÎ°ú ÏûÖÎ†•Ìïú Îç∞Ïù¥ÌÑ∞Î•º Î≥¥ÎÇ¥ insertÌïòÍ≥†
				// prodListÎ°ú data Î≥¥ÎÉÑ
				$.ajax({
					url : "insertmanufacture.do", 
					type : "POST",
					data : frmData,
					success : prodload,
					error : function(e){
						console.log(e);
					}
				});
			
			}
		</script>
		
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="${path}/resources/js/scripts.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
        <script src="${path}/resources/js/datatables-simple-demo.js"></script>
    </body>
</html>
